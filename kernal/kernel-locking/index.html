<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Unreliable Guide To Locking</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="Unreliable Guide To Locking" /><link rel="next" href="intro.html" title="Chapter 1. Introduction" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Unreliable Guide To Locking</th></tr><tr><td width="20%" align="left"> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="intro.html">Next</a></td></tr></table><hr /></div><div class="book"><div class="titlepage"><div><div><h1 class="title"><a id="LKLockingGuide"></a>Unreliable Guide To Locking</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Rusty</span> <span class="surname">Russell</span></h3><div class="affiliation"><div class="address"><p><br />
      <code class="email">&lt;<a class="email" href="mailto:rusty@rustcorp.com.au">rusty@rustcorp.com.au</a>&gt;</code><br />
     </p></div></div></div></div></div><div><p class="copyright">Copyright © 2003 Rusty Russell</p></div><div><div class="legalnotice"><a id="idp36509716"></a><p>
     This documentation is free software; you can redistribute
     it and/or modify it under the terms of the GNU General Public
     License as published by the Free Software Foundation; either
     version 2 of the License, or (at your option) any later
     version.
   </p><p>
     This program is distributed in the hope that it will be
     useful, but WITHOUT ANY WARRANTY; without even the implied
     warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
     See the GNU General Public License for more details.
   </p><p>
     You should have received a copy of the GNU General Public
     License along with this program; if not, write to the Free
     Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
     MA 02111-1307 USA
   </p><p>
     For more details see the file COPYING in the source
     distribution of Linux.
   </p></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="chapter"><a href="intro.html">1. Introduction</a></span></dt><dt><span class="chapter"><a href="races.html">2. The Problem With Concurrency</a></span></dt><dd><dl><dt><span class="sect1"><a href="races.html#race-condition">Race Conditions and Critical Regions</a></span></dt></dl></dd><dt><span class="chapter"><a href="locks.html">3. Locking in the Linux Kernel</a></span></dt><dd><dl><dt><span class="sect1"><a href="locks.html#lock-intro">Two Main Types of Kernel Locks: Spinlocks and Mutexes</a></span></dt><dt><span class="sect1"><a href="uniprocessor.html">Locks and Uniprocessor Kernels</a></span></dt><dt><span class="sect1"><a href="usercontextlocking.html">Locking Only In User Context</a></span></dt><dt><span class="sect1"><a href="lock-user-bh.html">Locking Between User Context and Softirqs</a></span></dt><dt><span class="sect1"><a href="lock-user-tasklet.html">Locking Between User Context and Tasklets</a></span></dt><dt><span class="sect1"><a href="lock-user-timers.html">Locking Between User Context and Timers</a></span></dt><dt><span class="sect1"><a href="lock-tasklets.html">Locking Between Tasklets/Timers</a></span></dt><dd><dl><dt><span class="sect2"><a href="lock-tasklets.html#lock-tasklets-same">The Same Tasklet/Timer</a></span></dt><dt><span class="sect2"><a href="lock-tasklets.html#lock-tasklets-different">Different Tasklets/Timers</a></span></dt></dl></dd><dt><span class="sect1"><a href="lock-softirqs.html">Locking Between Softirqs</a></span></dt><dd><dl><dt><span class="sect2"><a href="lock-softirqs.html#lock-softirqs-same">The Same Softirq</a></span></dt><dt><span class="sect2"><a href="lock-softirqs.html#lock-softirqs-different">Different Softirqs</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="hardirq-context.html">4. Hard IRQ Context</a></span></dt><dd><dl><dt><span class="sect1"><a href="hardirq-context.html#hardirq-softirq">Locking Between Hard IRQ and Softirqs/Tasklets</a></span></dt><dt><span class="sect1"><a href="hardirq-hardirq.html">Locking Between Two Hard IRQ Handlers</a></span></dt></dl></dd><dt><span class="chapter"><a href="cheatsheet.html">5. Cheat Sheet For Locking</a></span></dt><dd><dl><dt><span class="sect1"><a href="cheatsheet.html#minimum-lock-reqirements">Table of Minimum Requirements</a></span></dt></dl></dd><dt><span class="chapter"><a href="trylock-functions.html">6. The trylock Functions</a></span></dt><dt><span class="chapter"><a href="Examples.html">7. Common Examples</a></span></dt><dd><dl><dt><span class="sect1"><a href="Examples.html#examples-usercontext">All In User Context</a></span></dt><dt><span class="sect1"><a href="examples-interrupt.html">Accessing From Interrupt Context</a></span></dt><dt><span class="sect1"><a href="examples-refcnt.html">Exposing Objects Outside This File</a></span></dt><dd><dl><dt><span class="sect2"><a href="examples-refcnt.html#examples-refcnt-atomic">Using Atomic Operations For The Reference Count</a></span></dt></dl></dd><dt><span class="sect1"><a href="examples-lock-per-obj.html">Protecting The Objects Themselves</a></span></dt></dl></dd><dt><span class="chapter"><a href="common-problems.html">8. Common Problems</a></span></dt><dd><dl><dt><span class="sect1"><a href="common-problems.html#deadlock">Deadlock: Simple and Advanced</a></span></dt><dt><span class="sect1"><a href="techs-deadlock-prevent.html">Preventing Deadlock</a></span></dt><dd><dl><dt><span class="sect2"><a href="techs-deadlock-prevent.html#techs-deadlock-overprevent">Overzealous Prevention Of Deadlocks</a></span></dt></dl></dd><dt><span class="sect1"><a href="racing-timers.html">Racing Timers: A Kernel Pastime</a></span></dt></dl></dd><dt><span class="chapter"><a href="Efficiency.html">9. Locking Speed</a></span></dt><dd><dl><dt><span class="sect1"><a href="Efficiency.html#efficiency-rwlocks">Read/Write Lock Variants</a></span></dt><dt><span class="sect1"><a href="efficiency-read-copy-update.html">Avoiding Locks: Read Copy Update</a></span></dt><dt><span class="sect1"><a href="per-cpu.html">Per-CPU Data</a></span></dt><dt><span class="sect1"><a href="mostly-hardirq.html">Data Which Mostly Used By An IRQ Handler</a></span></dt></dl></dd><dt><span class="chapter"><a href="sleeping-things.html">10. What Functions Are Safe To Call From Interrupts?</a></span></dt><dd><dl><dt><span class="sect1"><a href="sleeping-things.html#sleeping">Some Functions Which Sleep</a></span></dt><dt><span class="sect1"><a href="dont-sleep.html">Some Functions Which Don't Sleep</a></span></dt></dl></dd><dt><span class="chapter"><a href="apiref.html">11. Mutex API reference</a></span></dt><dd><dl><dt><span class="refentrytitle"><a href="API-mutex-init.html"><span class="phrase">mutex_init</span></a></span><span class="refpurpose"> — 
  initialize the mutex
 </span></dt><dt><span class="refentrytitle"><a href="API-mutex-is-locked.html"><span class="phrase">mutex_is_locked</span></a></span><span class="refpurpose"> — 
     is the mutex locked
 </span></dt><dt><span class="refentrytitle"><a href="API-mutex-lock.html"><span class="phrase">mutex_lock</span></a></span><span class="refpurpose"> — 
  acquire the mutex
 </span></dt><dt><span class="refentrytitle"><a href="API-mutex-unlock.html"><span class="phrase">mutex_unlock</span></a></span><span class="refpurpose"> — 
     release the mutex
 </span></dt><dt><span class="refentrytitle"><a href="API-mutex-lock-interruptible.html"><span class="phrase">mutex_lock_interruptible</span></a></span><span class="refpurpose"> — 
     acquire the mutex, interruptible
 </span></dt><dt><span class="refentrytitle"><a href="API-mutex-trylock.html"><span class="phrase">mutex_trylock</span></a></span><span class="refpurpose"> — 
     try to acquire the mutex, without waiting
 </span></dt><dt><span class="refentrytitle"><a href="API-atomic-dec-and-mutex-lock.html"><span class="phrase">atomic_dec_and_mutex_lock</span></a></span><span class="refpurpose"> — 
     return holding mutex if we dec to 0
 </span></dt></dl></dd><dt><span class="chapter"><a href="references.html">12. Further reading</a></span></dt><dt><span class="chapter"><a href="thanks.html">13. Thanks</a></span></dt><dt><span class="glossary"><a href="glossary.html">Glossary</a></span></dt></dl></div><div class="list-of-tables"><p><strong>List of Tables</strong></p><dl><dt>2.1. <a href="races.html#idp36589988">Expected Results</a></dt><dt>2.2. <a href="races.html#idp36901308">Possible Results</a></dt><dt>5.1. <a href="cheatsheet.html#idp39371292">Table of Locking Requirements</a></dt><dt>5.2. <a href="cheatsheet.html#idp39388860">Legend for Locking Requirements Table</a></dt><dt>8.1. <a href="common-problems.html#idp39439884">Consequences</a></dt></dl></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="intro.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"> </td><td width="40%" align="right" valign="top"> Chapter 1. Introduction</td></tr></table></div></body></html>